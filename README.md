# Cross-Domain Evaluation
This repository contains the replication package for the work  *Cross-Domain Evaluation of Transformer-Based Vulnerability Detection on Open & Industry Data - A Mixed Study*. The work was conducted by Moritz Mock, Thomas Forrer, and Barbara Russo.

Link to the pre-print (under review)

Link to the publication (under review)

### Extraction of the datasets from the original source
The folder /create_datasets contains a README.md with execution examples one how to create the datasets. For the industry dataset, only the final dataset is shared; however, not the repositories leveraged to create it.

### Datasets
In the following Table a detailed view of each of the datasets, per project, severity levels of semgrep and sonarqube can be found.
The datasets themselves can be found in the folder /datasets
<table>
    <tr>
        <td>Project</td>
        <td># of functions</td>
        <td>Minor</td>
        <td>Major</td>
        <td>Critical</td>
        <td>Blocker</td>
        <td>Info</td>
        <td>CWE</td>
        <td>Warning</td>
        <td>Error</td>
        <td>CWE</td>
        <td>OWASP</td>
    </tr>
    <tr>
        <td>cakephp</td>
        <td>11,712</td>
        <td>9,214</td>
        <td>1,248</td>
        <td>1,004</td>
        <td>51</td>
        <td>0</td>
        <td>112</td>
        <td>7</td>
        <td>7</td>
        <td>14</td>
        <td>14</td>
    </tr>
    <tr>
        <td>CodeIgniter</td>
        <td>2,093</td>
        <td>1,597</td>
        <td>524</td>
        <td>248</td>
        <td>113</td>
        <td>1</td>
        <td>154</td>
        <td>13</td>
        <td>36</td>
        <td>44</td>
        <td>42</td>
    </tr>
    <tr>
        <td>cphalcon</td>
        <td>5,544</td>
        <td>5,521</td>
        <td>702</td>
        <td>284</td>
        <td>35</td>
        <td>28</td>
        <td>106</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>drupal</td>
        <td>40,916</td>
        <td>35,030</td>
        <td>8,934</td>
        <td>3,990</td>
        <td>354</td>
        <td>724</td>
        <td>1,299</td>
        <td>75</td>
        <td>17</td>
        <td>91</td>
        <td>90</td>
    </tr>
    <tr>
        <td>fatfree-core</td>
        <td>534</td>
        <td>297</td>
        <td>83</td>
        <td>136</td>
        <td>2</td>
        <td>0</td>
        <td>41</td>
        <td>10</td>
        <td>8</td>
        <td>18</td>
        <td>18</td>
    </tr>
    <tr>
        <td>flow</td>
        <td>6,732</td>
        <td>5,935</td>
        <td>2,310</td>
        <td>507</td>
        <td>18</td>
        <td>16</td>
        <td>91</td>
        <td>38</td>
        <td>87</td>
        <td>121</td>
        <td>121</td>
    </tr>
    <tr>
        <td>framework</td>
        <td>22,394</td>
        <td>17,098</td>
        <td>3,022</td>
        <td>917</td>
        <td>112</td>
        <td>0</td>
        <td>372</td>
        <td>21</td>
        <td>12</td>
        <td>33</td>
        <td>33</td>
    </tr>
    <tr>
        <td>fuel</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>horde-core</td>
        <td>1,545</td>
        <td>1,222</td>
        <td>326</td>
        <td>515</td>
        <td>4</td>
        <td>36</td>
        <td>121</td>
        <td>20</td>
        <td>19</td>
        <td>36</td>
        <td>34</td>
    </tr>
    <tr>
        <td>kanboard</td>
        <td>8,393</td>
        <td>6,081</td>
        <td>1,302</td>
        <td>380</td>
        <td>166</td>
        <td>6</td>
        <td>80</td>
        <td>12</td>
        <td>17</td>
        <td>28</td>
        <td>27</td>
    </tr>
    <tr>
        <td>laminas-code</td>
        <td>1,023</td>
        <td>955</td>
        <td>155</td>
        <td>51</td>
        <td>9</td>
        <td>5</td>
        <td>25</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>lithium</td>
        <td>4,309</td>
        <td>3,639</td>
        <td>698</td>
        <td>432</td>
        <td>10</td>
        <td>1</td>
        <td>290</td>
        <td>5</td>
        <td>15</td>
        <td>19</td>
        <td>15</td>
    </tr>
    <tr>
        <td>prado</td>
        <td>9,895</td>
        <td>8,428</td>
        <td>1,657</td>
        <td>520</td>
        <td>16</td>
        <td>9</td>
        <td>573</td>
        <td>28</td>
        <td>25</td>
        <td>48</td>
        <td>48</td>
    </tr>
    <tr>
        <td>Project</td>
        <td>8</td>
        <td>8</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>qcodo</td>
        <td>1,029</td>
        <td>552</td>
        <td>283</td>
        <td>286</td>
        <td>28</td>
        <td>0</td>
        <td>67</td>
        <td>9</td>
        <td>15</td>
        <td>23</td>
        <td>22</td>
    </tr>
    <tr>
        <td>server</td>
        <td>30,427</td>
        <td>23,578</td>
        <td>4,135</td>
        <td>1,870</td>
        <td>57</td>
        <td>102</td>
        <td>625</td>
        <td>34</td>
        <td>88</td>
        <td>121</td>
        <td>121</td>
    </tr>
    <tr>
        <td>Smart.Framework</td>
        <td>2,086</td>
        <td>932</td>
        <td>497</td>
        <td>275</td>
        <td>36</td>
        <td>6</td>
        <td>25</td>
        <td>6</td>
        <td>53</td>
        <td>59</td>
        <td>57</td>
    </tr>
    <tr>
        <td>symfony</td>
        <td>40,744</td>
        <td>35,069</td>
        <td>9,663</td>
        <td>2,802</td>
        <td>70</td>
        <td>8</td>
        <td>1,681</td>
        <td>225</td>
        <td>89</td>
        <td>312</td>
        <td>312</td>
    </tr>
    <tr>
        <td>WordPress</td>
        <td>10,558</td>
        <td>5,016</td>
        <td>1,438</td>
        <td>1,112</td>
        <td>917</td>
        <td>28</td>
        <td>99</td>
        <td>78</td>
        <td>141</td>
        <td>187</td>
        <td>185</td>
    </tr>
    <tr>
        <td>yii2</td>
        <td>6,831</td>
        <td>5,792</td>
        <td>1,195</td>
        <td>737</td>
        <td>31</td>
        <td>23</td>
        <td>169</td>
        <td>17</td>
        <td>16</td>
        <td>29</td>
        <td>29</td>
    </tr>
    <tr>
        <td>zikula-code</td>
        <td>587</td>
        <td>546</td>
        <td>77</td>
        <td>18</td>
        <td>0</td>
        <td>44</td>
        <td>12</td>
        <td>3</td>
        <td>2</td>
        <td>5</td>
        <td>5</td>
    </tr>
    <tr style="background-color: #ffeeba;">
        <td>Total</td>
        <td>206,647</td>
        <td>166,517</td>
        <td>38,249</td>
        <td>16,084</td>
        <td>2,029</td>
        <td>1,037</td>
        <td>5,942</td>
        <td>601</td>
        <td>647</td>
        <td>1,188</td>
        <td>1,173</td>
    </tr>
    <tr>
        <td>aiku</td>
        <td>12,616</td>
        <td>12,456</td>
        <td>2,496</td>
        <td>483</td>
        <td>31</td>
        <td>99</td>
        <td>164</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>akaunting</td>
        <td>4,069</td>
        <td>3,911</td>
        <td>541</td>
        <td>141</td>
        <td>29</td>
        <td>18</td>
        <td>129</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>biznisbox</td>
        <td>981</td>
        <td>972</td>
        <td>111</td>
        <td>32</td>
        <td>25</td>
        <td>0</td>
        <td>8</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>dolibarr</td>
        <td>24,743</td>
        <td>13,975</td>
        <td>5,416</td>
        <td>4,301</td>
        <td>576</td>
        <td>193</td>
        <td>658</td>
        <td>2</td>
        <td>7</td>
        <td>8</td>
        <td>8</td>
    </tr>
    <tr>
        <td>DoliDroid</td>
        <td>4</td>
        <td>2</td>
        <td>2</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>DoliMed</td>
        <td>101</td>
        <td>82</td>
        <td>54</td>
        <td>43</td>
        <td>7</td>
        <td>1</td>
        <td>3</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>DoliMods</td>
        <td>106,315</td>
        <td>3,313</td>
        <td>941</td>
        <td>953</td>
        <td>263</td>
        <td>19</td>
        <td>248</td>
        <td>4</td>
        <td>10</td>
        <td>12</td>
        <td>12</td>
    </tr>
    <tr>
        <td>SplashSync/Dolibarr</td>
        <td>567</td>
        <td>567</td>
        <td>154</td>
        <td>282</td>
        <td>2</td>
        <td>0</td>
        <td>14</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>ecclesiacrm</td>
        <td>2,843</td>
        <td>1,696</td>
        <td>868</td>
        <td>280</td>
        <td>50</td>
        <td>5</td>
        <td>87</td>
        <td>9</td>
        <td>7</td>
        <td>13</td>
        <td>13</td>
    </tr>
    <tr>
        <td>erp</td>
        <td>987</td>
        <td>987</td>
        <td>279</td>
        <td>8</td>
        <td>0</td>
        <td>0</td>
        <td>2</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>erpsaas</td>
        <td>1,556</td>
        <td>1,513</td>
        <td>207</td>
        <td>41</td>
        <td>11</td>
        <td>5</td>
        <td>18</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>facturascripts</td>
        <td>4,785</td>
        <td>4,542</td>
        <td>929</td>
        <td>434</td>
        <td>3</td>
        <td>1</td>
        <td>127</td>
        <td>0</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
    </tr>
    <tr>
        <td>limbas</td>
        <td>1,870</td>
        <td>1,213</td>
        <td>498</td>
        <td>334</td>
        <td>67</td>
        <td>28</td>
        <td>82</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
    </tr>
    <tr>
        <td>OpenXE</td>
        <td>38,636</td>
        <td>14,750</td>
        <td>1,704</td>
        <td>1,403</td>
        <td>130</td>
        <td>758</td>
        <td>1,082</td>
        <td>11</td>
        <td>14</td>
        <td>25</td>
        <td>25</td>
    </tr>
    <tr>
        <td>rosariosis</td>
        <td>1,718</td>
        <td>1,060</td>
        <td>377</td>
        <td>375</td>
        <td>442</td>
        <td>10</td>
        <td>55</td>
        <td>8</td>
        <td>58</td>
        <td>58</td>
        <td>58</td>
    </tr>
    <tr>
        <td>SaltOS</td>
        <td>6,940</td>
        <td>479</td>
        <td>104</td>
        <td>140</td>
        <td>351</td>
        <td>0</td>
        <td>11</td>
        <td>0</td>
        <td>5</td>
        <td>5</td>
        <td>5</td>
    </tr>
    <tr>
        <td>totum-mit</td>
        <td>1,186</td>
        <td>794</td>
        <td>282</td>
        <td>177</td>
        <td>16</td>
        <td>4</td>
        <td>88</td>
        <td>0</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
    </tr>
    <tr>
        <td>uzerp</td>
        <td>5,489</td>
        <td>4,165</td>
        <td>946</td>
        <td>558</td>
        <td>117</td>
        <td>26</td>
        <td>163</td>
        <td>1</td>
        <td>0</td>
        <td>1</td>
        <td>1</td>
    </tr>
    <tr>
        <td>webERP</td>
        <td>22,765</td>
        <td>783</td>
        <td>301</td>
        <td>208</td>
        <td>239</td>
        <td>35</td>
        <td>80</td>
        <td>7</td>
        <td>18</td>
        <td>18</td>
        <td>8</td>
    </tr>
    <tr style="background-color: #ffeeba;">
        <td>Total</td>
        <td>238,161</td>
        <td>67,260</td>
        <td>16,210</td>
        <td>10,195</td>
        <td>2,361</td>
        <td>1,202</td>
        <td>3,019</td>
        <td>43</td>
        <td>122</td>
        <td>143</td>
        <td>133</td>
    </tr>
    <tr>
        <td>glpi</td>
        <td>10,443</td>
        <td>8,635</td>
        <td>1,818</td>
        <td>2,253</td>
        <td>148</td>
        <td>52</td>
        <td>546</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>icinga-php-library</td>
        <td>4,356</td>
        <td>1</td>
        <td>0</td>
        <td>1</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>icinga-php-thirdparty</td>
        <td>24,299</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>icingaweb2</td>
        <td>13,439</td>
        <td>4,902</td>
        <td>427</td>
        <td>351</td>
        <td>42</td>
        <td>74</td>
        <td>216</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>icingaweb2-module-director</td>
        <td>5,093</td>
        <td>4,627</td>
        <td>402</td>
        <td>264</td>
        <td>33</td>
        <td>164</td>
        <td>324</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>icingaweb2-module-pdfexport</td>
        <td>1,237</td>
        <td>34</td>
        <td>8</td>
        <td>4</td>
        <td>1</td>
        <td>0</td>
        <td>5</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>icingaweb2-module-slm</td>
        <td>657</td>
        <td>642</td>
        <td>157</td>
        <td>28</td>
        <td>2</td>
        <td>1</td>
        <td>29</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr>
        <td>neteye-glpi</td>
        <td>4,809</td>
        <td>2,802</td>
        <td>524</td>
        <td>1,193</td>
        <td>96</td>
        <td>17</td>
        <td>281</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr style="background-color: #ffeeba;">
        <td>Total</td>
        <td>64,333</td>
        <td>21,644</td>
        <td>3,337</td>
        <td>4,094</td>
        <td>322</td>
        <td>308</td>
        <td>1,401</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
    </tr>
    <tr style="background-color: #DAF7A6;">
        <td>Grand Total</td>
        <td>509,141</td>
        <td>255,421</td>
        <td>57,796</td>
        <td>30,373</td>
        <td>4,712</td>
        <td>2,547</td>
        <td>10,362</td>
        <td>644</td>
        <td>769</td>
        <td>1,331</td>
        <td>1,306</td>
    </tr>
</table>

### Fine-Tuning of the model 
The folder /code-ml contains all the necessary information to fine-tune and validate, test, perform the cross-validation. Furthermore, it contains the the file `req.txt` which is needed to recreate the environment which was leveraged for the fine-tuning.

### Plots and Survey data
The folder /plots_results and /survey\ data contain all the results in a csv format and the corresponding plots presented in the paper, alongside the R notebook, which was used to create them.

### Implementation details
For the analysis, we implemented our approach using PyTorch 2.7 in Python 3. We ran the tasks in a cluster consisting of two Nvidia A100 GPUs with 192 GB of RAM on a server with the processor Xeon 4208, which has 16 cores per node, for a total of 32 cores.

#### Docker 
The folder /ml_docker_github contains the configuration which is needed to host an instance of the DL to be executed in the cloud. The model needs to stored in the path /ml_docker_github/ml_model, afterwards the container needs to created and pushed to dockerhub or any other hosting platform.

#### Pipeline
The folder /pipeline, contains the implementation of the pipeline. In the file /pipeline/actions/action_dl/Dockerfile the identifier of the containerized model need to be inserted.

## Note
This repository uses `git lsf`, teh documentation how to install it can be found under [https://git-lfs.com](https://git-lfs.com)

The fine-tuned models can be found under the following link [https://huggingface.co/collections/CybersecurityLab-unibz/cross-domain-evaluation-a-mixed-study-6863eff4a4ca45dfe8af7eed](https://huggingface.co/collections/CybersecurityLab-unibz/cross-domain-evaluation-a-mixed-study-6863eff4a4ca45dfe8af7eed).

<!--
## How to cite the work

#### Preprint:

```bibtext
```

#### Publication:


```bibtext
```

-->
